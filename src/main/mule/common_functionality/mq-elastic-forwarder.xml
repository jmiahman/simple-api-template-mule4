<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:elasticsearch="http://www.mulesoft.org/schema/mule/elasticsearch"
	xmlns:anypoint-mq="http://www.mulesoft.org/schema/mule/anypoint-mq" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/anypoint-mq http://www.mulesoft.org/schema/mule/anypoint-mq/current/mule-anypoint-mq.xsd
http://www.mulesoft.org/schema/mule/elasticsearch http://www.mulesoft.org/schema/mule/elasticsearch/current/mule-elasticsearch.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<flow name="mq-elastic-forwarderFlow" doc:id="9110c4c4-6c2b-4756-a7e7-0234aceee867" >
		<anypoint-mq:subscriber doc:name="Subscriber" doc:id="98af75fa-3a5f-4a73-ae2a-358c8a1557a9" config-ref="Anypoint_MQ_Config" destination="mule-elastic-queue"/>
		<ee:transform doc:name="Prepare Message for Elasticsearch" doc:id="06ae777b-00ab-41a1-93c6-06f0f309e8cb" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
    "user" : "MaxTheMule",
    "post_date" : "2020-11-15T14:12:12",
    "message" : payload
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to local Elasticsearch" doc:id="725f41e5-3a15-4781-99f7-477ee57d7b70" config-ref="HTTP_Elasticsearch" path="/mule-logs/_doc"/>
	</flow>
</mule>
